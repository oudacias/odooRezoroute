<?xml version="1.0" encoding="utf-8"?>
    <odoo>
        <record model="ir.ui.view" id="ps_rezoroute.partner">
            <field name="name">ps_rezoroute list</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">    
                <xpath expr="//header"  postion="attributes">
		            <!-- <field name="authorized_transaction_ids" invisible="1"/> -->
                    <!-- <button name="payment_action_capture" type="object" data-hotkey="shift+g"
                            string="Capture Transaction" class="oe_highlight"
                            attrs="{'invisible': [('authorized_transaction_ids', '=', [])]}"/>
                    <button name="payment_action_void" type="object"
                            string="Void Transaction" data-hotkey="shift+v"
                            confirm="Are you sure you want to void the authorized transaction? This action can't be undone."
                            attrs="{'invisible': [('authorized_transaction_ids', '=', [])]}"/>
                    <button name="%(sale.action_view_sale_advance_payment_inv)d" string="Create Invoice"
                        type="action" class="btn-primary" data-hotkey="q"
                        attrs="{'invisible': [('invoice_status', '!=', 'to invoice')]}"/>
                    <button name="%(sale.action_view_sale_advance_payment_inv)d" string="Create Invoice"
                        type="action" context="{'default_advance_payment_method': 'percentage'}" data-hotkey="q"
                        attrs="{'invisible': ['|',('invoice_status', '!=', 'no'), ('state', '!=', 'sale')]}"/>
                    <button name="action_quotation_send" string="Send by Email" type="object" states="draft" class="btn-primary" data-hotkey="g"/>
                    <button name="action_quotation_send" type="object" string="Send PRO-FORMA Invoice"
                      groups="sale.group_proforma_sales" class="btn-primary"
                      attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('invoice_count','&gt;=',1)]}" context="{'proforma': True}"/>
                    
                    <button name="action_quotation_send" type="object" string="Send PRO-FORMA Invoice" groups="sale.group_proforma_sales" attrs="{'invisible': ['|', ('state', '=', 'draft'), ('invoice_count','&gt;=',1)]}" context="{'proforma': True}"/>
                    <button name="action_quotation_send" string="Send by Email" type="object" states="sent,sale" data-hotkey="g"/>
                    <button name="action_cancel" type="object" string="Cancel" attrs="{'invisible': ['|', ('state', 'not in', ['draft', 'sent','sale']), ('id', '=', False)]}" data-hotkey="z"/>
                    <button name="action_draft" states="cancel" type="object" string="Set to Quotation" data-hotkey="w"/> -->
                                           <attribute name="invisible">1</attribute>

                </xpath>

                <xpath expr="//button[@name='action_confirm']" position="attributes">
                    <attribute name="groups">ps_rezoroute.group_siege</attribute>
                </xpath> 

                <xpath expr="//field[@name='validity_date']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='sale_order_template_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>

                <xpath expr="//button[@name='%(sale.action_view_sale_advance_payment_inv)d']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath> 
                <xpath expr="//button[@name='%(sale.action_view_sale_advance_payment_inv)d'][2]" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
               
                <xpath expr="//field[@name='payment_term_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='team_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='require_signature']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
               
                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="hide_action_tecrmi" invisible="1" modifiers="{'invisible': true, 'readonly': true}"/>
                    <field name="hide_confirm" invisible="1" modifiers="{'invisible': true, 'readonly': true}"/>

                    <field name="partner_ref" readonly="1"/>
                    <field name="paid_check" invisible="1"/>
                    <field name="mobile" attrs="{'required' : [('is_repair_order', '=', True)]}" modifiers="{'readonly': [['state', 'not in', ['to_prepare', 'customer_validated', 'repair_order', 'purchase_finished', 'waiting_replenishment', 'draft', 'making', 'prepared', 'sent']]], 'required': [['is_repair_order', '=', true]]}"/>
                    <field name="phone"  modifiers="{'readonly': [['state', 'not in', ['to_prepare', 'customer_validated', 'repair_order', 'purchase_finished', 'waiting_replenishment', 'draft', 'making', 'prepared', 'sent']]]}"/>

                    <field name="engin_id" options="{'always_reload': True}" domain="[('partner_id','=',partner_id)]" context="{'default_partner_id':'partner_id'}" attrs="{'required' : [('is_repair_order', '=', True)]}" modifiers="{'readonly': [['state', 'not in', ['to_prepare', 'customer_validated', 'repair_order', 'purchase_finished', 'waiting_replenishment', 'draft', 'making', 'prepared', 'sent']]], 'required': [['is_repair_order', '=', true]]}"/>
                </xpath>
                <xpath expr="//field[@name='engin_id']" position="after">
                    <field name="odometer" attrs="{'invisible': ['|', ('engin_id', '=', False),('is_central_company', '=', True)], 'required' : [('is_repair_order', '=', True)]}" modifiers="{'invisible': ['|', ['engin_id', '=', false], ['is_central_company', '=', true]], 'readonly': [['state', 'not in', ['to_prepare', 'customer_validated', 'repair_order', 'purchase_finished', 'waiting_replenishment', 'draft', 'making', 'prepared', 'sent']]], 'required': [['is_repair_order', '=', true]]}"/>
                    <field name="next_distri_date" attrs="{'invisible': ['|', ('engin_id', '=', False),('is_central_company', '=', True)]}" modifiers="{'invisible': ['|', ['engin_id', '=', false], ['is_central_company', '=', true]]}"/>
                    <field name="next_ct_date" attrs="{'invisible': ['|', ('engin_id', '=', False),('is_central_company', '=', True)]}" modifiers="{'invisible': ['|', ['engin_id', '=', false], ['is_central_company', '=', true]]}"/>
                </xpath>
                <xpath expr="//field[@name='date_order']" position="after">
                    <field name="is_central_company" invisible="1" modifiers="{'invisible': true, 'readonly': true}"/>
                    
                    <field name="client_order_ref" />
                    <field name="warehouse_id" />

                    <field name="categ_ids" widget="many2many_tags" modifiers="{'readonly': [['state', 'not in', ['waiting_replenishment', 'draft', 'repair_order', 'making', 'to_prepare', 'purchase_finished', 'customer_validated', 'sent', 'prepared']]]}"/>
                    <field name="is_repair_order" attrs="{'invisible': [('is_central_company', '=', True)],'readonly':[['state', 'not in', ['to_prepare', 'customer_validated', 'repair_order', 'purchase_finished', 'waiting_replenishment', 'draft', 'making', 'prepared', 'sent']]]}" on_change="1" modifiers="{'invisible': [['is_central_company', '=', true]], 'readonly': [['state', 'not in', ['to_prepare', 'customer_validated', 'repair_order', 'purchase_finished', 'waiting_replenishment', 'draft', 'making', 'prepared', 'sent']]]}"/>
                    <field name="user_repair_id" domain="[('company_id','=',company_id)]" widget="selection" attrs="{'required' : [('is_repair_order', '=', True)]}" modifiers="{'readonly': [['state', 'not in', ['to_prepare', 'customer_validated', 'repair_order', 'purchase_finished', 'waiting_replenishment', 'draft', 'making', 'prepared', 'sent']]], 'required': [['is_repair_order', '=', true]]}"/>
                    <field name="repair_order_note" attrs="{'invisible': [('is_repair_order', '=', False)]}" modifiers="{'invisible': [['is_repair_order', '=', false]], 'readonly': [['state', 'not in', ['to_prepare', 'customer_validated', 'repair_order', 'purchase_finished', 'waiting_replenishment', 'draft', 'making', 'prepared', 'sent']]]}"/>

                    
                    <field name="recover_your_used_parts" attrs="{'invisible': [('is_repair_order', '=', False)]}" modifiers="{'invisible': [['is_repair_order', '=', false]], 'readonly': [['state', 'not in', ['customer_validated', 'repair_order', 'purchase_finished', 'waiting_replenishment', 'draft', 'sent']]]}"/>
                    <field name="repair_with_re_used_parts" attrs="{'invisible': [('is_repair_order', '=', False)]}" modifiers="{'invisible': [['is_repair_order', '=', false]], 'readonly': [['state', 'not in', ['customer_validated', 'repair_order', 'purchase_finished', 'waiting_replenishment', 'draft', 'sent']]]}"/>
                </xpath>

                <xpath expr="//group[@name='sale_info']" position="inside">
                    <field name="hide_action_picking" invisible="1" modifiers="{'invisible': true, 'readonly': true}"/>
                    <field name="account_payment_type_id" domain="['|',('company_id','=',False),('company_id','=',company_id)]" modifiers="{}"/>
                    <field name="amount_residual" widget="monetary" options="{'currency_field': 'currency_id'}" modifiers="{'readonly': true}"/>
                    <field name="amount_total" nolabel="1" class="oe_subtotal_footer_separator" widget="monetary" options="{'currency_field': 'currency_id'}" modifiers="{'readonly': true}"/>


                    <field name="payment_term_id"/>
                    <field name="fiscal_position_id"/>
                    <field name="company_id" readonly="1"/>
                    <field name="is_outstanding_sale"/>
                
                        <field name="signer_url"/>
                        <field name="signer_name"/>
                        <field name="signer_date"/>
                   
                </xpath>            
                
                
                <xpath expr="//group[@name='sales_person']" position="inside">
                    <field name="is_quotation_sent"/>
                    <field name="date_quotation_sent"/>
                    <field name="is_invoice_sent"/>
                    <field name="date_invoice_sent"/>
                    <!-- <field name="new_campaign_id"/> -->
                    <!-- <field name="new_source_id"/> -->
                    <field name="start_datetime"/>
                    <field name="end_datetime"/>
                </xpath>
                <xpath expr="//group[@name='sale_shipping']" position="inside">
                    <field name="picking_policy"/>
                    <field name="payment_method_ids"/>
                    <!-- <field name="order_policy"/> -->
                    <field name="is_customer_account"/>
                    <field name="hide_action_processed" invisible="1" modifiers="{'invisible': true, 'readonly': true}"/>
                    <field name="hide_action_invoice" invisible="1" modifiers="{'invisible': true, 'readonly': true}"/>
                    <field name="customer_invoice_type"/>
                </xpath>


                

            </field>
        </record>

        <record model="ir.actions.act_window" id="ps_rezoroute.order_deposit_wizard">
            <field name="name">ps_rezoroute window</field>
            <field name="res_model">order.deposit.wizard</field>
            <field name="view_mode">form</field>
        </record>

        <record model="ir.actions.act_window" id="ps_rezoroute.order_repair_confirm">
            <field name="name">ps_rezoroute window</field>
            <field name="res_model">order.repair.confirm</field>
            <field name="view_mode">form</field>
        </record>

        <record id="order_repair_confirm_wizard" model="ir.ui.view">
            <field name="name">ps_rezoroute window</field>
            <field name="model">order.repair.confirm</field>
            <field name="arch" type="xml">
                <form string="Confirmation de l'ordre de réparation">
                    <group string="Ordre de réparation">
                        <field name="sale_order_id" readonly="1"/>
                        <field name="client_id" readonly="1"/>
                        <field name="engin_order_id" readonly="1"/>
                        <field name="odometer"/>
                        <field name="next_distri_date"/>
                        <field name="next_ct_date"/>
                    </group>
                    <group string="Informations de réparation">
                        <field name="user_repair_id" readonly="1"/>
                        <field name="repair_order_note"/>
                        
                    </group>
                    <footer>
                        <button name="confirm_order" string="Confirmer Réparation" type="object" class="oe_highlight"/>
                    </footer>
                </form>
            </field>
        </record>
                            






        <record id="sale_order_view_search_inherit_quotation_or" model="ir.ui.view">
            <field name="name">sale.order.search.inherit.quotation.or</field>
            <field name="model">sale.order</field>
            <field name="mode">primary</field>
            <field name="inherit_id" ref="sale.view_sales_order_filter"/>
            <field name="arch" type="xml">
            <!-- <xpath expr="//filter[@name='my_sale_orders_filter']" position="replace">

                <button name="action_view_facture"
                    class="oe_stat_button"
                    icon="fa-money"
                    type="object">
                    <field name="facture_count" widget="statinfo" string="Factures"/>
                </button>
 -->




                <xpath expr="//filter[@name='my_sale_orders_filter']" position="replace">
                    <field name="campaign_id"/>
                    <separator/>
                    <filter string="My Quotations" name="my_quotation" domain="[('user_id','=',uid),('state','=','repair_order')]"/>
                    <separator/>
                    <filter string="Quotations" name="draft" domain="[('state','in',('repair_order'))]"/>
                    <filter string="Sales Orders" name="sales" domain="[('state','in',('repair_order'))]"/>
                    <separator/>
                    <filter string="Create Date" name="filter_create_date" date="create_date"/>
                </xpath>
            </field>
        </record>
        <record id="action_quotations_or" model="ir.actions.act_window">
            <field name="name">Quotations OR</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <!-- <field name="search_view_id" ref="ps_rezoroute.sale_order_view_search_inherit_quotation_or_end"/> -->
            <field name="view_mode">tree</field>
        </record>
       
        <record id="sale_order_view_search_inherit_quotation_or_end" model="ir.ui.view">
            <field name="name">sale.order.search.inherit.quotation.or</field>
            <field name="model">sale.order</field>
            <field name="mode">primary</field>
            <field name="inherit_id" ref="sale.view_sales_order_filter"/>
            <field name="arch" type="xml">
                <xpath expr="//filter[@name='my_sale_orders_filter']" position="replace">
                    <field name="campaign_id"/>
                    <separator/>
                    <filter string="My Quotations" name="my_quotation" domain="[('user_id','=',uid),('state','=','repair_order')]"/>
                    <separator/>
                    <filter string="Quotations" name="draft" domain="[('state','in',('repair_order'))]"/>
                    <filter string="Sales Orders" name="sales" domain="[('state','in',('repair_order'))]"/>
                    <separator/>
                    <filter string="Create Date" name="filter_create_date" date="create_date"/>
                </xpath>
            </field>
        </record>

        <record id="action_quotations_or_end" model="ir.actions.act_window">
            <field name="name">Quotations OR</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <!-- <field name="search_view_id" ref="sale_order_view_search_inherit_quotation_or_end"/> -->
            <field name="view_mode">tree</field>
        </record>

        
       
        <menuitem id="sale_order_menu_or"
            name="Ordre de réparation"
            parent="sale.sale_menu_root"
            sequence="2"/>


        <menuitem id="menu_sale_quotations"
                name="OR en cours"
                action="action_quotations_or"
                parent="ps_rezoroute.sale_order_menu_or"
                sequence="1" groups="sales_team.group_sale_salesman"/>

        <menuitem id="menu_sale_quotations_end"
                name="OR terminés"
                action="action_quotations_or_end"
                parent="ps_rezoroute.sale_order_menu_or"
                sequence="1" groups="sales_team.group_sale_salesman"/>


    </odoo>